{% extends "layout.html" %}

{% block title %}Importuj Grafik z Excela{% endblock %}

{% block extra_styles %}
<style>
    .import-card-container {
        max-width: 800px;
        margin: 2rem auto;
    }
    .import-instructions {
        background-color: var(--background-color);
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
        border: 1px solid var(--border-color);
    }
    .import-instructions h4 {
        margin-top: 0;
        margin-bottom: 1rem;
        color: var(--text-color);
    }
    .import-instructions p {
        color: var(--secondary-color);
        line-height: 1.6;
    }
    .import-instructions ul {
        list-style-type: none;
        padding-left: 0;
        margin-top: 1rem;
    }
    .import-instructions li {
        position: relative;
        padding-left: 25px;
        margin-bottom: 0.75rem;
    }
    .import-instructions li::before {
        content: '✓';
        position: absolute;
        left: 0;
        color: var(--success-color);
        font-weight: bold;
    }
    .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: block;
        width: 100%;
        text-align: center;
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        padding: 2rem;
        background-color: var(--background-color);
        cursor: pointer;
        transition: border-color 0.2s, background-color 0.2s;
    }
    .file-input-wrapper:hover {
        border-color: var(--primary-color);
        background-color: var(--table-stripe-color);
    }
    .file-input-wrapper input[type="file"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }
    .file-input-label {
        color: var(--secondary-color);
        font-weight: 500;
    }
    .file-input-label span {
        display: block;
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }
    #file-name-display {
        margin-top: 1rem;
        font-style: italic;
        color: var(--text-color);
    }
</style>
{% endblock %}

{% block content %}
<div class="import-card-container">
    <div class="card">
        <div class="card-header">
            <h1>Importuj Grafik z Excela</h1>
        </div>
        <div class="card-body">

            <div class="import-instructions">
                <h4>Instrukcja importu</h4>
                <p>Upewnij się, że Twój plik Excel (.xlsx) ma odpowiednią strukturę (plik <strong>nie powinien</strong> zawierać nagłówków):</p>
                <ul>
                    <li><strong>Kolumna A:</strong> Data (w formacie RRRR-MM-DD lub DD.MM.RRRR)</li>
                    <li><strong>Kolumna B:</strong> Nazwa / Cel podróży</li>
                    <li><strong>Kolumna C:</strong> Potwierdzenie (wpisz "tak" lub zostaw puste)</li>
                </ul>
                <p style="margin-top: 1rem;">Wiersze, w których kolumna B i C są puste, zostaną automatycznie zignorowane.</p>
                <!-- POPRAWKA: 'download_sample' zmienione na 'admin.download_sample' -->
                <a href="{{ url_for('admin.download_sample') }}" class="button button-secondary" style="margin-top: 10px;">Pobierz przykładowy plik</a>
            </div>

            <form method="POST" enctype="multipart/form-data" action="{{ url_for('admin.import_excel') }}">
                <div class="form-group">
                    <div class="file-input-wrapper">
                        <label for="excel_file" class="file-input-label">
                            <span>Kliknij, aby wybrać plik</span> lub przeciągnij go tutaj
                        </label>
                        <input type="file" id="excel_file" name="excel_file" accept=".xlsx, .xls" required>
                    </div>
                    <div id="file-name-display"></div>
                </div>
                <div style="margin-top: 2rem;">
                    <button type="submit" class="button button-primary button-full-width">Rozpocznij import</button>
                </div>
            </form>

        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('excel_file');
    const fileNameDisplay = document.getElementById('file-name-display');

    if (fileInput) {
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                fileNameDisplay.textContent = `Wybrano plik: ${this.files[0].name}`;
            } else {
                fileNameDisplay.textContent = '';
            }
        });
    }
});
</script>
{% endblock %}

